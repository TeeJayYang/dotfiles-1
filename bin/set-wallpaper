#!/usr/bin/env python

import i3ipc
import os
import subprocess
import signal
import sys

wallpaper_folder = os.path.expanduser(os.path.join(
    '~',
    '.config',
    'i3',
    'images',
))
default_wallpaper = os.path.join(wallpaper_folder, 'wallpaper.png')
blurred_wallpaper = os.path.join(wallpaper_folder, 'wallpaper_blurred.png')

i3 = i3ipc.Connection()

def signal_handler(signal, frame):
    subprocess.call(['feh', '--bg-scale', default_wallpaper])
    i3.main_quit()
    sys.exit(0)
signal.signal(signal.SIGINT, signal_handler)
signal.signal(signal.SIGTERM, signal_handler)

def update_wallpaper():
    if i3.get_tree().find_focused().name == i3.get_tree().find_focused().workspace().name:
        wallpaper = default_wallpaper
    else:
        wallpaper = blurred_wallpaper
    subprocess.call(['feh', '--bg-scale', wallpaper])

def on_change(i3, e):
    if e.change in ['focus', 'new', 'close', 'move']:
        update_wallpaper()

i3.on('workspace', on_change)
i3.on('window', on_change)
i3.main()
